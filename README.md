# kernel_api_diff

It seems you've split the reporting functionality into a second script (`generate_csv_html_report.py`). I'll combine the previous `report_generator.py` and `compare_ctags.py` into their respective READMEs.

Here are the README files for your two Python scripts.

-----

# ðŸ”Ž Kernel API Change Analysis Toolkit Readme

This toolkit provides a two-step process to automatically extract and report **syntactic** interface differences between two versions of the Linux kernel using **Universal Ctags**.

## 1\. `compare_ctags.py`

**Purpose**: The primary analysis script. It parses raw Ctags JSON output from two kernel versions, compares the definitions of functions, macros, and structures, and outputs a structured JSON file detailing the differences.

### Prerequisites

1.  **Universal Ctags**: Must be installed on your system. Standard `ctags` is insufficient as it doesn't reliably support JSON output or detailed signature fields.
2.  **Two Kernel Source Trees**: Cloned and ready (e.g., `linux-v5.15` and `linux-v6.1`).

### Step 1: Generate Ctags JSON Files

Use Universal Ctags with the following command-line flags. Focus on the `include/` directory for core API changes.

```bash
# Define target directories (e.g., core headers and a specific subsystem)
KERNEL_DIRS="include drivers/nvme"

# 1. Generate for Version A (e.g., v5.15)
ctags -R -o tags_v5.15.json --output-format=json \
      --fields=+nS --languages=C --kinds-C=+p \
      $(for d in $KERNEL_DIRS; do echo /path/to/linux-v5.15/$d; done)

# 2. Generate for Version B (e.g., v6.1)
ctags -R -o tags_v6.1.json --output-format=json \
      --fields=+nS --languages=C --kinds-C=+p \
      $(for d in $KERNEL_DIRS; do echo /path/to/linux-v6.1/$d; done)
```

### Step 2: Run the Comparison Script

This script consumes the two JSON files and generates the primary API changes report.

#### Usage

```bash
python3 compare_ctags.py <file_A> <version_A> <file_B> <version_B> [OPTIONS]
ython3 compare_ctags.py linux-5.15.195/tags.json "5.15" linux-6.17.5/tags.json "6.1" -o kernel_api_changes.jso
```

| Argument | Description | Example |
| :--- | :--- | :--- |
| `file_A` | Path to the Ctags JSON for the older version. | `tags_v5.15.json` |
| `version_A` | Name of the older version. | `"v5.15"` |
| `file_B` | Path to the Ctags JSON for the newer version. | `tags_v6.1.json` |
| `version_B` | Name of the newer version. | `"v6.1"` |

#### Options

| Option | Default | Description |
| :--- | :--- | :--- |
| `-o`, `--output` | `kernel_api_changes.json` | Output filename for the JSON report. |

#### Output Structure

The output is a dictionary where keys are the symbol names and values detail the change:

```json
{
    "alloc-workqueue": {
        "sigce": "v6.1",
        "change_type": "arguments_modified",
        "old_signature": "struct workqueue_struct *alloc_workqueue(const char *fmt, unsigned int flags, int max_active, ...)",
        "new_signature": "struct workqueue_struct *alloc_workqueue(const char *fmt, unsigned int flags, ...)",
        "semantic_change": "TODO: Manual analysis required to determine semantic impact." ðŸ‘ˆ **Requires Manual Review**
    }
    // ... more entries
}
```

-----

## 2\. `generate_csv_html_report.py`

**Purpose**: Takes the JSON report generated by `compare_ctags.py`, flattens the data, and formats it into user-friendly **CSV** and **HTML** reports for easy viewing and manual analysis.

### Prerequisites

1.  **Input JSON File**: The output from `compare_ctags.py`.

### Usage

```bash
python3 generate_csv_html_report.py <input_json> [OPTIONS]
python3 generate_csv_html_report.py kernel_api_changes.json    --vA "v5.15"     --vB "v6.1"      -c "kernel_v5.15_to_v6.1.csv"       -H "kernel_v5.15_to_v6.1.html"
```

| Argument | Description | Example |
| :--- | :--- | :--- |
| `input_json` | Path to the API changes JSON file. | `kernel_api_changes.json` |

### Options

| Option | Default | Description |
| :--- | :--- | :--- |
| `-c`, `--csv` | `api_changes_report.csv` | Output filename for the CSV report. |
| `-H`, `--html` | `api_changes_report.html` | Output filename for the HTML report. |
| `--vA` | `vA` | Version A name (used in report titles). |
| `--vB` | `vB` | Version B name (used in report titles). |

### Output Reports

1.  **CSV Report**: Simple spreadsheet format for filtering and data manipulation.
2.  **HTML Report**:
      * **Styled Table**: Columns are intelligently sized for readability.
      * **Color-Coded Rows**: Highlights changes instantly:
          * ðŸŸ¢ **Added** (Green)
          * ðŸ”´ **Removed** (Red)
          * ðŸŸ¡ **Modified** (Yellow/Orange)
      * **Visual Prompts**: The "Semantic Impact" column is bolded and highlighted with a **TODO** prompt, guiding the developer on where expert manual review is mandatory.

### Recommended Workflow

1.  **Generate Tags**: Run Ctags on both kernel versions.
2.  **Compare Symbols**: Run `compare_ctags.py` to get `kernel_api_changes.json`.
3.  **Generate Reports**: Run `generate_csv_html_report.py` to create `api_changes_report.html`.
4.  **Expert Review**: Open the HTML report and manually review every entry, updating the `semantic_change` field in the original JSON with expert analysis (e.g., "The function now requires the caller to hold a spinlock.") .
5.  **Final Report**: Re-run `generate_csv_html_report.py` to generate the final, fully analyzed CSV and HTML reports.